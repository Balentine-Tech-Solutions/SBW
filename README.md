# SBW CLI Tool - SBWv1.i2 Mark I Prototype

The SBW (Shoot-By-Wire) CLI Tool is a Python-based command-line application for decoding, decrypting, and visualizing SBW log files generated by embedded firmware.

## Overview

This tool implements the complete host-side processing pipeline for SBW data:

**Decode → Decrypt → Decompress → Parse TLV → Export/Visualize**

### Key Features

- **AES-GCM Decryption**: Mirrors firmware encryption settings exactly
- **Decompression**: Supports LZ4 and Heatshrink algorithms
- **TLV Parsing**: Handles IMU, Temperature, Health, and Session metadata
- **Data Export**: CSV and JSON formats with proper timestamping
- **Visualization**: Time-series graphs for sensor data analysis
- **Error Handling**: Graceful handling of corrupted or missing blocks
- **Cross-Platform**: Runs on Windows, macOS, and Linux

## Installation

### Prerequisites

- Python 3.10 or higher
- pip package manager

### Install from Source

```bash
# Clone the repository
cd SDW

# Install in development mode
pip install -e .

# Or install dependencies directly
pip install -r requirements.txt
```

## Usage

### Basic Command Structure

```bash
# Basic decoding
sbw-cli decode input.sbw --out output_directory/

# With export options
sbw-cli decode input.sbw --out results/ --csv --json --plots

# Verbose output
sbw-cli decode input.sbw --out analysis/ --verbose
```

### Command Options

- `input_file`: Path to the SBW log file (`.sbw`)
- `--out, -o`: Output directory for decoded data (required)
- `--csv`: Export data to CSV format
- `--json`: Export data to JSON format  
- `--plots`: Generate visualization plots
- `--verbose, -v`: Enable verbose logging
- `--config, -c`: Path to configuration file

### Example Workflows

```bash
# Quick decode and export to CSV
sbw-cli decode session_001.sbw --out decoded/ --csv

# Full analysis with all outputs
sbw-cli decode flight_log.sbw --out analysis/ --csv --json --plots --verbose

# Using custom configuration
sbw-cli decode test.sbw --out results/ --config custom_config.json
```

## Output Files

The tool generates several types of output files:

### Data Exports

- `imu_data.csv`: IMU sensor data (accelerometer and gyroscope)
- `temperature_data.csv`: Temperature sensor readings
- `health_data.csv`: System health metrics
- `sbw_data_complete.json`: Complete dataset in JSON format

### Visualizations

- `imu_accelerometer.png`: Accelerometer data plots (X/Y/Z vs time)
- `imu_gyroscope.png`: Gyroscope data plots (X/Y/Z vs time)
- `temperature.png`: Temperature vs time
- `health_metrics.png`: System health metrics vs time
- `summary_dashboard.png`: Combined overview dashboard

## Configuration

The tool supports configuration files in JSON or YAML format:

```json
{
  "crypto": {
    "algorithm": "AES-GCM",
    "tag_length": 16,
    "nonce_length": 12
  },
  "compression": {
    "algorithm": "lz4"
  },
  "export": {
    "timestamp_format": "%Y-%m-%d %H:%M:%S.%f",
    "csv_delimiter": ","
  },
  "visualization": {
    "figure_size": [12, 8],
    "dpi": 300
  }
}
```

## Development

### Project Structure

```
SDW/
├── sbw_cli/                 # Main package
│   ├── core/               # Core processing modules
│   │   ├── decoder.py      # Main decoder orchestration
│   │   ├── crypto.py       # AES-GCM decryption
│   │   ├── compression.py  # LZ4/Heatshrink decompression
│   │   ├── tlv_parser.py   # TLV data parsing
│   │   ├── exporter.py     # CSV/JSON export
│   │   └── visualizer.py   # Plot generation
│   ├── utils/              # Utility modules
│   │   ├── config.py       # Configuration management
│   │   └── logger.py       # Logging setup
│   └── main.py            # CLI entry point
├── tests/                  # Test suite
├── docs/                   # Documentation
├── examples/              # Example files
├── requirements.txt       # Dependencies
└── setup.py              # Package setup
```

### Running Tests

```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=sbw_cli

# Run specific test file
pytest tests/test_decoder.py
```

### Development Timeline

- **Phase 1** (Week 1): CLI + Base Loader
- **Phase 2** (Week 2): Decryption Pipeline  
- **Phase 3** (Week 3): Decompression + TLV Parsing
- **Phase 4** (Week 4-5): Export & Visualization
- **Phase 5** (Week 6-8): Integration Testing

## Architecture

### Processing Pipeline

1. **File Loading**: Read and validate SBW log files
2. **Block Parsing**: Extract encrypted blocks using LG-1.0 specification
3. **Decryption**: AES-GCM decryption using EN-1.0 crypto profile
4. **Decompression**: LZ4 or Heatshrink decompression
5. **TLV Parsing**: Parse sensor data using TL-1.0 specification
6. **Export**: Generate CSV and JSON output files
7. **Visualization**: Create time-series plots and dashboards

### Error Handling

- Detects corrupted blocks and continues processing
- Validates file integrity and block structure
- Provides detailed error reporting and logging
- Graceful degradation for partial data recovery

## Mark I Scope

This Mark I prototype focuses specifically on:

✅ **Included**:
- File-based offline decoding
- AES-GCM decryption
- LZ4/Heatshrink decompression
- TLV parsing for IMU/Temperature/Health data
- CSV/JSON export
- Basic visualization
- Error handling and logging

❌ **Not Included** (Mark II/III):
- WiFi/BLE decoding
- Real-time streaming
- Cloud backend integration
- Mobile applications
- Web dashboards
- Satellite interfaces

## Contributing

This is a focused prototype for the SBW platform development. Contact the development team for contribution guidelines.

## Technical Specifications

The tool implements the following specifications:

- **TL-1.0**: TLV data format specification
- **LG-1.0**: Block header format specification  
- **EN-1.0**: Encryption and crypto profile specification

*Note: These specifications will be provided by the embedded team during development.*

## Support

For technical issues or questions:

1. Check the verbose logging output (`--verbose`)
2. Review error messages and warnings
3. Verify input file format and integrity
4. Contact the development team with detailed error logs

---

**SBW CLI Tool v1.0.0** - SBWv1.i2 Mark I Prototype  
Developed by Demond Balentine for Balentine Tech Solutions
